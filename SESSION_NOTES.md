# CFRD Support Bot v2 - –ó–∞–º–µ—Ç–∫–∏

> **–ï–î–ò–ù–´–ï –ó–ê–ú–ï–¢–ö–ò:** `/root/supportbot-saas/NOTES.md`
>
> –¢–∞–º –æ–ø–∏—Å–∞–Ω—ã –û–ë–ê –ø—Ä–æ–µ–∫—Ç–∞ (v2 –∏ SaaS) –∏ –∫–∞–∫ –∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å.
> –ü—Ä–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –±–∞–≥–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—è–π –∏ –ø—Ä–∞–≤—å –æ–±–∞!

## –ö–∞–∫ –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–π —Å–µ—Å—Å–∏–∏

```
–ø—Ä–æ–¥–æ–ª–∂–∞–µ–º support bot
```

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (2025-12-18)

**–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ PRODUCTION!** –ß–µ—Ä–µ–∑ systemd —Å–µ—Ä–≤–∏—Å `cfrd-support-bot-v2.service`

---

## –í–ê–ñ–ù–û: –ë–∞–≥ –≤ pyrofork 2.3.69

**–ü—Ä–æ–±–ª–µ–º–∞:** High-level –º–µ—Ç–æ–¥ `client.create_forum_topic()` –ù–ï –†–ê–ë–û–¢–ê–ï–¢!

–í–Ω—É—Ç—Ä–∏ pyrofork –≤—ã–∑—ã–≤–∞–µ—Ç:
```python
raw.functions.messages.CreateForumTopic(channel=..., ...)
```
–ù–æ raw –∫–ª–∞—Å—Å –æ–∂–∏–¥–∞–µ—Ç `peer=...`, –∞ –Ω–µ `channel=...`.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å raw API –Ω–∞–ø—Ä—è–º—É—é:
```python
peer = await client.resolve_peer(SUPPORT_GROUP_ID)
result = await client.invoke(
    pyrogram.raw.functions.messages.CreateForumTopic(
        peer=peer,
        title=thread_title,
        random_id=random.randint(1, 999999),
        icon_color=random.randint(0, 7)
    )
)

# –ò–∑–≤–ª–µ—á—å ID —Ç—Ä–µ–¥–∞:
thread_id = None
if hasattr(result, 'updates'):
    for update in result.updates:
        if hasattr(update, 'message') and hasattr(update.message, 'id'):
            thread_id = update.message.id
            break
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤:** `bot.py` - —Ñ—É–Ω–∫—Ü–∏–∏ `create_support_thread`, `create_thread_for_client`, `handle_create_test_topic`

**GitHub:** https://github.com/dscfrd/cfrd-support-bot-v2

### –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```bash
# –°—Ç–∞—Ç—É—Å
systemctl status cfrd-support-bot-v2

# –õ–æ–≥–∏
journalctl -u cfrd-support-bot-v2 -f

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
systemctl restart cfrd-support-bot-v2
```

---

## Notion - –°—Ç–∞—Ç—å–∏ –¥–ª—è –ª–µ–Ω–¥–∏–Ω–≥–∞

**–†–∞–∑–¥–µ–ª:** –°—Ç–∞—Ç—å—è (ID: 2cbce2e0-0f4c-8050-98c7-fc089743cb6f)

**–°—Ç—Ä–∞–Ω–∏—Ü—ã:**
- –û–ø–∏—Å–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤: https://notion.so/2cbce2e00f4c817ab973d465c226c177
- –ú–∞–∫–µ—Ç –ª–µ–Ω–¥–∏–Ω–≥–∞: https://notion.so/2cbce2e00f4c81898981ded8db2f8ff0

**5 –∫–ª—é—á–µ–≤—ã—Ö –±–æ–ª–µ–π ‚Üí —Ä–µ—à–µ–Ω–∏–π:**
1. CRM —Å–ª–æ–∂–Ω–æ ‚Üí –í—Å—ë –≤ Telegram
2. –ù–µ –≤–∏–¥–Ω–æ –ø–µ—Ä–µ–ø–∏—Å–∫–∏ ‚Üí –ì—Ä—É–ø–ø–∞ —Å —Ç—Ä–µ–¥–∞–º–∏
3. –ö–ª–∏–µ–Ω—Ç—ã –∂–¥—É—Ç ‚Üí –ê–≤—Ç–æ—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
4. –ú–µ–Ω–µ–¥–∂–µ—Ä —É—à—ë–ª ‚Üí –ò—Å—Ç–æ—Ä–∏—è –æ—Å—Ç–∞—ë—Ç—Å—è, —Å–º–µ–Ω–∞ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
5. –ë–æ—Ç –±–µ–∑–ª–∏–∫–∏–π ‚Üí –ò–º—è + —Ñ–æ—Ç–æ + –¥–æ–ª–∂–Ω–æ—Å—Ç—å –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
/root/cfrd-support-bot-v2/
‚îú‚îÄ‚îÄ bot.py                      # –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç (~4000 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ config.py                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ database.py                 # –§—É–Ω–∫—Ü–∏–∏ –ë–î (~490 —Å—Ç—Ä–æ–∫)
‚îú‚îÄ‚îÄ venv/                       # Virtualenv —Å Pyrofork 2.3.69
‚îú‚îÄ‚îÄ handlers/                   # –ü—É—Å—Ç–∞—è (–¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
‚îú‚îÄ‚îÄ bot.log                     # –õ–æ–≥–∏
‚îú‚îÄ‚îÄ business_account_test.session
‚îî‚îÄ‚îÄ clients_test.db
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (—Ç–µ—Å—Ç–æ–≤–∞—è)

- –¢–µ–ª–µ—Ñ–æ–Ω: +79851730392
- –ì—Ä—É–ø–ø–∞: -1003317645437 (New_client)
- –°–µ—Å—Å–∏—è: business_account_test
- –ë–î: clients_test.db

## –ë–æ–µ–≤–æ–π –±–æ—Ç (–ù–ï –¢–†–û–ì–ê–¢–¨!)

- –ü—É—Ç—å: /bot/support-cfrd-bot.py
- –¢–µ–ª–µ—Ñ–æ–Ω: +79859482949
- –ì—Ä—É–ø–ø–∞: -1002675883945

---

## Notion –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

**API –∫–ª—é—á:** `[–°–ï–ö–†–ï–¢ - —Å–º. .env]`
**Database ID:** `e670d16d6abd49f4bb388727df4291e7`

---

## –ó–ê–î–ê–ß–ò –ò–ó NOTION

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- –ù—É–∂–Ω—ã –ø—Ä–∞–≤–∫–∏: 14
- –ì–æ—Ç–æ–≤–æ: 19

---

### –ö–†–ò–¢–ò–ß–ù–´–ï (0 –æ—Å—Ç–∞–ª–æ—Å—å) ‚úÖ

~~1. **–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞** - ‚úÖ –ì–û–¢–û–í–û~~

~~2. **–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤–∏–¥–µ–æ** - ‚úÖ –ì–û–¢–û–í–û~~

~~3. **–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ–± —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏** - ‚úÖ –ì–û–¢–û–í–û~~

~~4. **–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ–± –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏** - ‚úÖ –ì–û–¢–û–í–û~~

---

### –ñ–ï–õ–ê–¢–ï–õ–¨–ù–´–ï (2 –∑–∞–¥–∞—á–∏ –æ—Å—Ç–∞–ª–æ—Å—å)

1. **–î–æ–±–∞–≤–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–¥–∞**
   - –ö–æ–º–∞–Ω–¥–∞: –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è
   - –§–æ—Ä–º–∞—Ç: [‚Ññ —Ç—Ä–µ–¥–∞: –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏]
   - –£–±—Ä–∞—Ç—å –Ω–∏–∫–Ω–µ–π–º –∫–ª–∏–µ–Ω—Ç–∞ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è

2. **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞**
   - –ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —á–∞—Ç –ø–µ—Ä–≤—ã–π —Ä–∞–∑

~~3. **–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏** - ‚úÖ –ì–û–¢–û–í–û~~

---

### –£–î–û–ë–°–¢–í–û (1 –æ—Å—Ç–∞–ª–æ—Å—å)

~~1. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ** - –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (Telegram –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —á—É–∂–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è)~~

~~2. **–£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ** - ‚úÖ –ì–û–¢–û–í–û (–∫–æ–º–∞–Ω–¥–∞ /del)~~

3. **–û—Ç—á–µ—Ç –æ–± –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –†–µ–∞–∫—Ü–∏—è –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–∏ –≤–º–µ—Å—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –±–æ—Ç–∞

---

### –£–ü–†–ê–í–õ–ï–ù–ò–ï –ú–ï–ù–ï–î–ñ–ï–†–ê–ú–ò (–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏)

1. **/reassign @—Å—Ç–∞—Ä—ã–π @–Ω–æ–≤—ã–π** - –ü–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –≤—Å–µ —Ç—Ä–µ–¥—ã
   - –ö–æ–≥–¥–∞ –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–±–æ–ª–µ–ª/—É–≤–æ–ª–∏–ª—Å—è
   - –í—Å–µ —Ç—Ä–µ–¥—ã —Å—Ç–∞—Ä–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –∫ –Ω–æ–≤–æ–º—É

2. **/unassign @–º–µ–Ω–µ–¥–∂–µ—Ä** - –°–Ω—è—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
   - –£–±—Ä–∞—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞ —Å–æ –≤—Å–µ—Ö –µ–≥–æ —Ç—Ä–µ–¥–æ–≤
   - –¢—Ä–µ–¥—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è "–±–µ–∑ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ"

3. **/remove_manager @–º–µ–Ω–µ–¥–∂–µ—Ä** - –£–¥–∞–ª–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
   - –£–¥–∞–ª–∏—Ç—å –∏–∑ —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–∏
   - –°–Ω—è—Ç—å —Å–æ –≤—Å–µ—Ö —Ç—Ä–µ–¥–æ–≤ + —É–¥–∞–ª–∏—Ç—å –∏–∑ –ë–î

---

### –ù–ï–ö–†–ò–¢–ò–ß–ù–´–ï (9 –∑–∞–¥–∞—á)

1. **/threads** - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–µ–¥–æ–≤
   - –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ç—Ä–µ–¥—ã –∑–∞ 2 –Ω–µ–¥–µ–ª–∏
   - –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—ã –∏ –±–æ—Ç–æ–≤ (788, 1327, 1308, –±–æ—Ç 513)

2. **–£–±—Ä–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—á–∞—Ç—å –ø–æ id –∫–ª–∏–µ–Ω—Ç–∞**
   - –¢–æ–ª—å–∫–æ id —Ç—Ä–µ–¥–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏

3. **/wtt** - –ü—Ä–æ—Å–º–æ—Ç—Ä –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç—Ä–µ–¥–µ
   - –î–æ–±–∞–≤–∏—Ç—å –¥–∞—Ç—É –ø–µ—Ä–≤–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –ë–∞–≥: "–ø–µ—Ä–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ"

4. **–ü–µ—Ä–µ—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è**
   - –ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Å–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç—É

5. **–ü–æ—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ**

6. **/files** - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
   - –ë–∞–≥: –µ—Å–ª–∏ –ø–µ—Ä–µ–¥—É–º–∞–ª –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª - –æ—à–∏–±–∫–∞

7. **/ok {ID —Ç—Ä–µ–¥–∞}** - –û—Ç–∫–ª—é—á–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
   - –ë–∞–≥: –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–¥–∞ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

8. **/myinfo** - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –ë–∞–≥: "too many values to unpack (expected 8)"

9. **–£–±—Ä–∞—Ç—å –ª–∏—à–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏**
   - /find, /group_info, /myinfo, ID –∫–ª–∏–µ–Ω—Ç–∞

---

### –ì–û–¢–û–í–û (15 –∑–∞–¥–∞—á)

1. /card {ID_—Ç—Ä–µ–¥–∞} - –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∏–µ–Ω—Ç—É
2. /set_id - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ID –∑–∞–∫–∞–∑—á–∏–∫—É (–ª–∞—Ç–∏–Ω–∏—Ü–∞)
3. /set_id - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ID –∑–∞–∫–∞–∑—á–∏–∫—É (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞)
4. /set_id - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ID –∑–∞–∫–∞–∑—á–∏–∫—É (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞ + —Ü–∏—Ñ—Ä—ã)
5. /set_id - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ ID –∑–∞–∫–∞–∑—á–∏–∫—É (—Ü–∏—Ñ—Ä—ã)
6. /onduty @username {ID_—Ç—Ä–µ–¥–∞} - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ
7. /auth (–ø–æ–≤—Ç–æ—Ä–Ω–æ) - –ü–æ–≤—Ç–æ—Ä–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞
8. /help - –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
9. /duties - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö
10. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
11. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –∫–ª–∏–µ–Ω—Ç—É
12. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ
13. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
14. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Ü–∏—Ç–∞—Ç—ã (—ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ markdown)
15. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ reply (–Ω–∞ –∫–∞–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª)

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-12

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É

**–û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
**–ò–º—è –§–∞–º–∏–ª–∏—è @username:**

–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
+ 1 –≤–∏–¥–µ–æ
```

**–ü–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
```
**–ò–º—è @user** –ø–µ—Ä–µ—Å–ª–∞–ª –æ—Ç **–í–∏–∫–∞ @vika**:

–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
+ 4 —Ñ–æ—Ç–æ
```

**–ü–µ—Ä–µ—Å–ª–∞–Ω–Ω–æ–µ –∏–∑ –∫–∞–Ω–∞–ª–∞:**
```
**–ò–º—è @user** –ø–µ—Ä–µ—Å–ª–∞–ª –∏–∑ **–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞ @channel**:

–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
+ 4 —Ñ–æ—Ç–æ
```

**–û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ (reply):**
```
**–ò–º—è @username:**
‚Ü©Ô∏è –í –æ—Ç–≤–µ—Ç –Ω–∞: _—Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–≤–µ—Ç–∏–ª–∏_

–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
```

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫ –∫–ª–∏–µ–Ω—Ç—É

**–ü–æ–¥–ø–∏—Å—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–º:**
```
–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
‚Äî
`üîµ –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤, –º–µ–Ω–µ–¥–∂–µ—Ä`
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **escape_markdown()** - —Ñ—É–Ω–∫—Ü–∏—è —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤ `*`, `_`, `` ` ``, `[`, `]` –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ª–æ–º–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

2. **reply_info** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–æ–±—â–µ–Ω–∏–∏, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–µ –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª

3. **–ú–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω–∞—è –ø–æ–¥–ø–∏—Å—å** - –ø–æ–¥–ø–∏—Å—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –º–æ–Ω–æ—à–∏—Ä–∏–Ω–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º

---

## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã

```bash
# –ü–µ—Ä–µ–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /root/cfrd-support-bot-v2

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ (–ß–ï–†–ï–ó VENV!)
nohup ./venv/bin/python bot.py >> bot.log 2>&1 &

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f bot.log

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
pkill -f "venv/bin/python bot.py"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep python | grep -v grep
```

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-13

### Virtualenv –∏ Pyrofork

- –°–æ–∑–¥–∞–Ω virtualenv –≤ –ø–∞–ø–∫–µ `venv/`
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **Pyrofork 2.3.69** (—Ñ–æ—Ä–∫ Pyrogram —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π quote)
- –ë–æ–µ–≤–æ–π –±–æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π Pyrogram 2.0.106 - **–Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç**
- **–í–ê–ñ–ù–û:** –ó–∞–ø—É—Å–∫–∞—Ç—å –±–æ—Ç–∞ —á–µ—Ä–µ–∑ `./venv/bin/python bot.py`

### Quote (—Ü–∏—Ç–∞—Ç—ã) - –†–ê–ë–û–¢–ê–ï–¢!

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –æ—Ç–≤–µ—Ç–µ —Å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–º —Ç–µ–∫—Å—Ç–æ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ü–∏—Ç–∞—Ç–∞:
```
**–ò–º—è @username:**
üìù –¶–∏—Ç–∞—Ç–∞: _–≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç_

–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
```

### Reply –Ω–∞ —Ü–∏—Ç–∞—Ç—ã (NEW!)

**–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Å–æ–æ–±—â–µ–Ω–∏–π** - —Ö—Ä–∞–Ω–∏—Ç —Å–≤—è–∑—å –º–µ–∂–¥—É ID —Å–æ–æ–±—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–∞ –∏ ID —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –≥—Ä—É–ø–ø–µ.

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ —Ü–∏—Ç–∞—Ç–µ/–æ—Ç–≤–µ—Ç–µ –∫–ª–∏–µ–Ω—Ç–∞:
1. –ë–æ—Ç –∏—â–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ
2. –î–µ–ª–∞–µ—Ç reply –Ω–∞ –Ω–µ–≥–æ (–Ω–µ –ø—Ä–æ—Å—Ç–æ –≤ —Ç–æ–ø–∏–∫)
3. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–∏–¥–∏—Ç –Ω–∞ –∫–∞–∫–æ–µ –∏–º–µ–Ω–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç –æ—Ç–≤–µ—Ç–∏–ª

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `message_mapping` –≤ database.py
- –§—É–Ω–∫—Ü–∏–∏: `save_message_mapping()`, `get_group_message_id()`, `get_client_message_id()`
- –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ -> —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–∞–ø–ø–∏–Ω–≥
- –ü—Ä–∏ –æ—Ç–≤–µ—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ -> —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–∞–ø–ø–∏–Ω–≥
- –ü—Ä–∏ —Ü–∏—Ç–∞—Ç–µ -> reply –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–µ

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω EditForumTopic

- –í Pyrofork API –∏–∑–º–µ–Ω–∏–ª—Å—è: `messages.EditForumTopic` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `peer=` (–≤–º–µ—Å—Ç–æ `channels.EditForumTopic` —Å `channel=`)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ `TOPIC_NOT_MODIFIED`

### GitHub

- –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: https://github.com/dscfrd/cfrd-support-bot-v2
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: `gh auth login`
- Push: `git push origin master`

### Reply –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç—É (NEW!)

–ö–æ–≥–¥–∞ –º–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç—Ä–µ–¥–µ —Å –∫–æ–º–∞–Ω–¥–æ–π, –∫–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –∫–∞–∫ reply:
```
Reply –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ + /4 —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
‚Üí –ö–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –æ—Ç–≤–µ—Ç –∫–∞–∫ reply –Ω–∞ —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ (NEW!)

**–ö–ª–∏–µ–Ω—Ç –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–ª —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
‚úèÔ∏è –ò–º—è @username –∏–∑–º–µ–Ω–∏–ª –Ω–∞:
–Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç
```
(–ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ reply –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)

**–ö–ª–∏–µ–Ω—Ç —É–¥–∞–ª–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ:**
```
üóë –ò–º—è @username —É–¥–∞–ª–∏–ª —Å–æ–æ–±—â–µ–Ω–∏–µ
```
(–ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ reply –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ)

### –ö–æ–º–∞–Ω–¥–∞ /del (NEW!)

–ú–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ —É –∫–ª–∏–µ–Ω—Ç–∞:
1. Reply –Ω–∞ —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —Ç—Ä–µ–¥–µ
2. –ù–∞–ø–∏—Å–∞—Ç—å `/del`
3. –°–æ–æ–±—â–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è —É –∫–ª–∏–µ–Ω—Ç–∞

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)

- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `message_text` –≤ —Ç–∞–±–ª–∏—Ü—É `message_mapping` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞
- –§—É–Ω–∫—Ü–∏—è `update_message_text()` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ –º–∞–ø–ø–∏–Ω–≥–µ
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `on_edited_message` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `on_deleted_messages` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
- –ö–æ–º–∞–Ω–¥–∞ `/del` –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è —É –∫–ª–∏–µ–Ω—Ç–∞

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

- **–ë–∞–≥ Pyrofork —Å send_media_group**: `Messages.__init__() missing 'topics'`
  - –û–±—ë—Ä–Ω—É—Ç–æ –≤ try/except, –æ—à–∏–±–∫–∞ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è (—Å–æ–æ–±—â–µ–Ω–∏—è –≤—Å—ë —Ä–∞–≤–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è)

---

## –ì–û–¢–û–í–û (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

–î–æ–±–∞–≤–ª–µ–Ω–æ:
- ‚úÖ –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ–± —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
- ‚úÖ –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ–± –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏
- ‚úÖ –£–¥–∞–ª–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ (–º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ —É –∫–ª–∏–µ–Ω—Ç–∞)
- ‚úÖ Reply –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–∞–∫ reply —É –∫–ª–∏–µ–Ω—Ç–∞
- ‚úÖ –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ —Ä–µ–∞–∫—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ)

### –û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ —Ä–µ–∞–∫—Ü–∏—è—Ö (NEW!)

–ö–æ–≥–¥–∞ –∫–ª–∏–µ–Ω—Ç —Å—Ç–∞–≤–∏—Ç/—É–±–∏—Ä–∞–µ—Ç —Ä–µ–∞–∫—Ü–∏—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
üëç –ò–º—è @username –ø–æ—Å—Ç–∞–≤–∏–ª —Ä–µ–∞–∫—Ü–∏—é: ‚ù§Ô∏è üëç üî•
‚ûñ –ò–º—è @username —É–±—Ä–∞–ª —Ä–µ–∞–∫—Ü–∏—é
```

- –ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –º–∞–ø–ø–∏–Ω–≥–µ - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∫ reply
- –ö–∞—Å—Ç–æ–º–Ω—ã–µ —ç–º–æ–¥–∑–∏ (premium) –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–∞–∫ ‚ú®

---

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-14

### –ö–æ–º–∞–Ω–¥–∞ /company (NEW!)

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞:
```
/company 4 –û–û–û –†–æ–º–∞—à–∫–∞
```
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç—Ä–µ–¥–∞: `4: –ò–º—è –ö–ª–∏–µ–Ω—Ç–∞ | –û–û–û –†–æ–º–∞—à–∫–∞`
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `company_name` –≤ —Ç–∞–±–ª–∏—Ü—É `clients`

### –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞

–£–±—Ä–∞–Ω @username, –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Ç—Ä–µ–ª–∫–∞-—Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å:
```
**–ò–º—è –§–∞–º–∏–ª–∏—è ‚Üó**

–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
+ 1 –≤–∏–¥–µ–æ
```
–ì–¥–µ `‚Üó` ‚Äî —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å –∫–ª–∏–µ–Ω—Ç–∞ (tg://user?id=...)

### –û–±–Ω–æ–≤–ª—ë–Ω deprecated API

- `message.forward_from` ‚Üí `message.forward_origin`
- –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `get_forward_info()` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–µ—Ä–µ—Å—ã–ª–∫–∞–º–∏
- –£–±—Ä–∞–Ω—ã warnings –≤ –ª–æ–≥–∞—Ö

### Reactions Bot (reactions_bot.py)

–°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–π:
- –¢–æ–∫–µ–Ω: business bot @cfrdmega_bot
- **–û–ì–†–ê–ù–ò–ß–ï–ù–ò–ï:** Telegram Business API –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç —Ä–µ–∞–∫—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Bot API
- –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∫–æ–≥–¥–∞ Telegram –¥–æ–±–∞–≤–∏—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

- `database.py`: –¥–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `set_company_name()`, `get_company_name()`, `get_client_info_for_thread_title()`
- `bot.py`: –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ `/company`, –æ–±–Ω–æ–≤–ª—ë–Ω —Ñ–æ—Ä–º–∞—Ç user_name –≤–æ –≤—Å–µ—Ö –º–µ—Å—Ç–∞—Ö
- `/help` –æ–±–Ω–æ–≤–ª—ë–Ω —Å –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥–æ–π

---

### –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞–º–∏ (NEW!)

**–¢–∏—Ä—ã –∫–ª–∏–µ–Ω—Ç–æ–≤:**
- `/tier [ID_—Ç—Ä–µ–¥–∞] [1|2|3]` - —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏—Ä –∫–ª–∏–µ–Ω—Ç–∞ (tier-1, tier-2, tier-3)
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `tier` –≤ —Ç–∞–±–ª–∏—Ü—É `clients`

**–û—Ç–ø—É—Å–∫/–±–æ–ª—å–Ω–∏—á–Ω—ã–π:**
- `/vacation @–º–µ–Ω–µ–¥–∂–µ—Ä @–∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—å [tier-1 tier-2 tier-3]` - –ø–µ—Ä–µ–¥–∞—Ç—å —Ç—Ä–µ–¥—ã –∑–∞–º–µ—Å—Ç–∏—Ç–µ–ª—é
- `/return @–º–µ–Ω–µ–¥–∂–µ—Ä` - –≤–µ—Ä–Ω—É—Ç—å —Ç—Ä–µ–¥—ã –∏–∑ –æ—Ç–ø—É—Å–∫–∞
- –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–∏—Ä—ã –¥–ª—è —á–∞—Å—Ç–∏—á–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏
- –ù–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ `manager_substitutions` –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–º–µ—â–µ–Ω–∏–π

**–£–≤–æ–ª—å–Ω–µ–Ω–∏–µ:**
- `/team` - –ø–æ–∫–∞–∑–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ –≤—Å–µ—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (–∏–º—è, ID, username, —Ç—Ä–µ–¥–æ–≤, —Å—Ç–∞—Ç—É—Å)
- `/fire @–Ω–æ–≤—ã–π_–º–µ–Ω–µ–¥–∂–µ—Ä` (reply –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫—É) - —É–≤–æ–ª–∏—Ç—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞
  - –ü–µ—Ä–µ–¥–∞—Ç—å –≤—Å–µ —Ç—Ä–µ–¥—ã –Ω–æ–≤–æ–º—É –º–µ–Ω–µ–¥–∂–µ—Ä—É
  - –£–¥–∞–ª–∏—Ç—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  - –£–¥–∞–ª–∏—Ç—å –∏–∑ –≥—Ä—É–ø–ø—ã

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `database.py`: —Ñ—É–Ω–∫—Ü–∏–∏ `set_client_tier()`, `get_client_tier()`, `get_threads_by_tier()`
- `database.py`: —Ñ—É–Ω–∫—Ü–∏–∏ `start_vacation()`, `end_vacation()`, `is_on_vacation()`, `get_vacation_info()`
- `bot.py`: –∫–æ–º–∞–Ω–¥—ã `/tier`, `/vacation`, `/return`, `/team`, `/fire`
- –£–¥–∞–ª–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã `/reassign`, `/unassign`, `/remove_manager`

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-14 (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ)

### –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç—Ä–µ–¥–æ–≤

–ï—Å–ª–∏ —É –∫–ª–∏–µ–Ω—Ç–∞ –∑–∞–¥–∞–Ω custom_id (—á–µ—Ä–µ–∑ /id), –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–æ –Ω–æ–º–µ—Ä–∞ —Ç—Ä–µ–¥–∞:

**–ï—Å–ª–∏ ID –∑–∞–¥–∞–Ω:**
```
–ò–≤–∞–Ω–æ–≤: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ | –û–û–û –†–æ–º–∞—à–∫–∞ (123)
```

**–ï—Å–ª–∏ ID –Ω–µ –∑–∞–¥–∞–Ω:**
```
123: –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ | –û–û–û –†–æ–º–∞—à–∫–∞
```

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `database.py`: –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è `format_thread_title()` –¥–ª—è –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
- `get_client_info_for_thread_title()` —Ç–µ–ø–µ—Ä—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `custom_id`
- –û–±–Ω–æ–≤–ª–µ–Ω—ã: `mark_thread_urgent()`, `/company`, `/id`
- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ /id –∏–ª–∏ /company

### –ö–æ–º–∞–Ω–¥–∞ /readme (NEW!)

–°–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–æ—Ç—É:
```
/readme
```
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª README.txt
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤ /help

**–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ README.txt:**
- –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ (—Å—Ö–µ–º–∞ –∫–ª–∏–µ–Ω—Ç ‚Üí –±–æ—Ç ‚Üí –≥—Ä—É–ø–ø–∞)
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ (—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è, –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
- –í—Å–µ –∫–æ–º–∞–Ω–¥—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
- –§–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ —Ç—Ä–µ–¥–æ–≤
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- UTF-8 BOM –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ Windows

---

## –ì–û–¢–û–í–û (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-12-14)

- ‚úÖ /company - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –≤ —Ç—Ä–µ–¥–µ
- ‚úÖ –§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π: `–ò–º—è ‚Üó` (—Å—Ç—Ä–µ–ª–∫–∞ = —Å—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ—Ñ–∏–ª—å)
- ‚úÖ Deprecated forward_from API –æ–±–Ω–æ–≤–ª—ë–Ω –Ω–∞ forward_origin
- ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ: –ø–µ—Ä–µ—Å–ª–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –≤–∏–¥–µ–æ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ /tier - —Ç–∏—Ä—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ (tier-1, tier-2, tier-3)
- ‚úÖ /vacation, /return - —Å–∏—Å—Ç–µ–º–∞ –∑–∞–º–µ—â–µ–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- ‚úÖ /team, /fire - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π –∏ —É–≤–æ–ª—å–Ω–µ–Ω–∏–µ
- ‚úÖ –ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤: custom_id –≤–º–µ—Å—Ç–æ –Ω–æ–º–µ—Ä–∞ —Ç—Ä–µ–¥–∞ (–Ω–æ–º–µ—Ä –≤ —Å–∫–æ–±–∫–∞—Ö)
- ‚úÖ /readme - —Å–∫–∞—á–∞—Ç—å –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-14 (—á–∞—Å—Ç—å 2)

### Graceful Shutdown (NEW!)

–ë–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ SIGTERM/SIGINT:
- –ñ–¥—ë—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø (–¥–æ 5 —Å–µ–∫—É–Ω–¥)
- –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–∏—á–∏–Ω—É –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–µ—Å—Å–∏—é Pyrogram

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω `import signal`
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `shutdown_requested`
- –§—É–Ω–∫—Ü–∏—è `graceful_shutdown(sig_name)`
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ `signal_handler()`

### –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤ –∏ —à–∞–±–ª–æ–Ω—ã (NEW!)

–ö–∞–Ω–∞–ª-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ FILES_CHANNEL_ID = -1003563685324 (–ê—Ä—Ö–∏–≤_support)

**–ö–æ–º–∞–Ω–¥—ã:**
- `/upload` - –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (reply –Ω–∞ —Ñ–∞–π–ª —Å caption = –∏–º—è)
  - –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≥—Ä—É–ø–ø—ã
- `/file [–∏–º—è]` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –∫–ª–∏–µ–Ω—Ç—É
- `/temp [–∏–º—è]` - –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª + —Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞ –∫–ª–∏–µ–Ω—Ç—É
- `/files` - —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**Workflow –¥–ª—è /temp:**
1. –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∏—à–µ—Ç `/temp –≤–∏–∑–∏—Ç–∫–∞` –≤ —Ç—Ä–µ–¥–µ
2. –ë–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç "–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤–º–µ—Å—Ç–µ —Å —Ñ–∞–π–ª–æ–º"
3. –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç
4. –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ñ–∞–π–ª + —Ç–µ–∫—Å—Ç

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `config.py`: –¥–æ–±–∞–≤–ª–µ–Ω FILES_CHANNEL_ID
- `database.py`: —Ç–∞–±–ª–∏—Ü–∞ `file_templates`, —Ñ—É–Ω–∫—Ü–∏–∏ `save_file_template()`, `get_file_template()`, `list_file_templates()`, `delete_file_template()`, `update_template_text()`
- `bot.py`: –∫–æ–º–∞–Ω–¥—ã `/upload`, `/file`, `/files`, `/temp`, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ —à–∞–±–ª–æ–Ω–∞

### –§–æ—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ –∫–∞–Ω–∞–ª–µ (NEW!)

–§–æ—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–∞–Ω–∞–ª–µ FILES_CHANNEL_ID —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è–ª–∏—Å—å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ /auth –º–µ–Ω–µ–¥–∂–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ
2. –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫–∞–Ω–∞–ª —Å –ø–æ–¥–ø–∏—Å—å—é "üì∏ –§–æ—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞: –ò–º—è (ID: 123)"
3. message_id —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î (–∫–æ–ª–æ–Ω–∫–∞ `photo_channel_message_id`)
4. –ü—Ä–∏ /card —Ñ–æ—Ç–æ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –∫–∞–Ω–∞–ª–∞ –ø–æ message_id

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `database.py`: –∫–æ–ª–æ–Ω–∫–∞ `photo_channel_message_id` –≤ `managers`
- `database.py`: —Ñ—É–Ω–∫—Ü–∏—è `get_manager_photo_channel_id()`
- `bot.py`: –æ–±–Ω–æ–≤–ª—ë–Ω `handle_manager_photo()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∫–∞–Ω–∞–ª
- `bot.py`: –æ–±–Ω–æ–≤–ª—ë–Ω `send_manager_card_to_client()` - –±–µ—Ä—ë—Ç –∏–∑ –∫–∞–Ω–∞–ª–∞

---

## –ì–û–¢–û–í–û (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-12-14)

- ‚úÖ Graceful shutdown (SIGTERM/SIGINT)
- ‚úÖ /upload - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
- ‚úÖ /file - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ –∫–ª–∏–µ–Ω—Ç—É
- ‚úÖ /temp - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–∞ —Å —Ç–µ–∫—Å—Ç–æ–º
- ‚úÖ /files - —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –§–æ—Ç–æ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –≤ –∫–∞–Ω–∞–ª–µ (–Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞)
- ‚úÖ –£–±—Ä–∞–Ω –¥–æ–±–∞–≤–æ—á–Ω—ã–π –Ω–æ–º–µ—Ä –∏–∑ /auth –∏ –ø–æ–¥–ø–∏—Å–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
- ‚úÖ –ö–∞—Å—Ç–æ–º —ç–º–æ–¥–∑–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ (—Ñ–æ—Ç–æ –≤ –ø–æ–¥–ø–∏—Å–∏ –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏)

### –£–±—Ä–∞–Ω –¥–æ–±–∞–≤–æ—á–Ω—ã–π –Ω–æ–º–µ—Ä (extension)

**–ë—ã–ª–æ:**
- `/auth üîß, –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤, –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, 1234`
- –ü–æ–¥–ø–∏—Å—å: `üîß –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤, –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, –¥–æ–±. 1234`
- –ö–∞—Ä—Ç–æ—á–∫–∞: "–Ω–∞–±–µ—Ä–∏—Ç–µ –¥–æ–±–∞–≤–æ—á–Ω—ã–π: 1234"

**–°—Ç–∞–ª–æ:**
- `/auth üîß, –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤, –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç`
- –ü–æ–¥–ø–∏—Å—å: `üîß –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤, –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç`
- –ö–∞—Ä—Ç–æ—á–∫–∞: –±–µ–∑ –¥–æ–±–∞–≤–æ—á–Ω–æ–≥–æ

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `database.py`: `save_manager()` - extension —Ç–µ–ø–µ—Ä—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π (default="")
- `bot.py`: `/auth` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç 3 —á–∞—Å—Ç–∏ –≤–º–µ—Å—Ç–æ 4
- `bot.py`: –ø–æ–¥–ø–∏—Å—å –±–µ–∑ ", –¥–æ–±. {extension}"
- `bot.py`: –∫–∞—Ä—Ç–æ—á–∫–∞ –±–µ–∑ —Å—Ç—Ä–æ–∫–∏ —Å –¥–æ–±–∞–≤–æ—á–Ω—ã–º
- `README.txt`, `/help` - –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

---

## –ü–õ–ê–ù–´ –ù–ê –ë–£–î–£–©–ï–ï

### WebRTC –±–æ—Ç –¥–ª—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∑–≤–æ–Ω–∫–æ–≤ (–û–ü–¶–ò–û–ù–ê–õ–¨–ù–û)

**–û—Ç–¥–µ–ª—å–Ω—ã–π –±–æ—Ç** –¥–ª—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –æ–±—â–µ–Ω–∏—è —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏:
- WebRTC –¥–ª—è –∑–≤–æ–Ω–∫–æ–≤ –ø—Ä—è–º–æ –∏–∑ Telegram
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å **Whisper OpenAI** - —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ –≤ —Ç–µ–∫—Å—Ç
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å **Grok** - —Ä–µ–∑—é–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
- –¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç—ã –∏ —Å–∞–º–º–∞—Ä–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç—Ä–µ–¥

**–í–ê–ñ–ù–û:** –≠—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –±–æ—Ç, –Ω–µ –≤—Ö–æ–¥–∏—Ç –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É. –û—Å–Ω–æ–≤–Ω–æ–π –±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ –±–µ–∑ –Ω–µ–≥–æ.

### –ö–∞—Å—Ç–æ–º–Ω—ã–µ —ç–º–æ–¥–∑–∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ ‚Äî –†–ï–ê–õ–ò–ó–û–í–ê–ù–û ‚úÖ

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –ü—Ä–∏ `/auth` –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç —Ñ–æ—Ç–æ
2. –§–æ—Ç–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–µ–∑–∞–µ—Ç—Å—è –≤ –∫—Ä—É–≥ 100x100 px
3. –î–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å—Ç–∏–∫–µ—Ä–ø–∞–∫ `cfrd_managers_emoji`
4. `custom_emoji_id` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –ë–î
5. –í –ø–æ–¥–ø–∏—Å–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Å—Ç–æ–º —ç–º–æ–¥–∑–∏ –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–ª—è —Ñ–æ—Ç–æ:** –ª–∏—Ü–æ –¥–æ–ª–∂–Ω–æ –∑–∞–Ω–∏–º–∞—Ç—å ~80% –∫–∞–¥—Ä–∞

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:**
- –°—Ç–∏–∫–µ—Ä–ø–∞–∫: `t.me/addemoji/cfrd_managers_emoji`
- –ö–æ–Ω—Ñ–∏–≥: `EMOJI_PACK_NAME` –≤ config.py
- –§—É–Ω–∫—Ü–∏—è: `add_manager_emoji()` ‚Äî —Å–æ–∑–¥–∞—ë—Ç —ç–º–æ–¥–∑–∏ –∏–∑ —Ñ–æ—Ç–æ
- –§—É–Ω–∫—Ü–∏—è: `format_signature_with_custom_emoji()` ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø–æ–¥–ø–∏—Å—å —Å entities
- –ü–æ–ª–µ –≤ –ë–î: `custom_emoji_id` –≤ —Ç–∞–±–ª–∏—Ü–µ `managers`
- –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ `entities` –≤–º–µ—Å—Ç–æ `parse_mode` –¥–ª—è –∫–∞—Å—Ç–æ–º —ç–º–æ–¥–∑–∏

---

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-15

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã /team –∏ /help (BUG FIX!)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–æ–º–∞–Ω–¥—ã `/team` –∏ `/help` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–æ–≥–¥–∞ –∏—Ö –æ—Ç–ø—Ä–∞–≤–ª—è–ª –≤–ª–∞–¥–µ–ª–µ—Ü –±–∏–∑–Ω–µ—Å-–∞–∫–∫–∞—É–Ω—Ç–∞ (—á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç).

**–ü—Ä–∏—á–∏–Ω–∞:**
–ë–∞–≥ –≤ pyrofork ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã `filters.command()` –∏ `filters.regex()` –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç –¥–ª—è "–∏—Å—Ö–æ–¥—è—â–∏—Ö" —Å–æ–æ–±—â–µ–Ω–∏–π (`outgoing=true`). –ö–æ–≥–¥–∞ –≤–ª–∞–¥–µ–ª–µ—Ü –∞–∫–∫–∞—É–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É, –æ–Ω–æ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –∏—Å—Ö–æ–¥—è—â–µ–µ –∏ —Ñ–∏–ª—å—Ç—Ä—ã –µ–≥–æ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç.

**–†–µ—à–µ–Ω–∏–µ:**
–°–æ–∑–¥–∞–Ω **—Ä–æ—É—Ç–µ—Ä –∫–æ–º–∞–Ω–¥** (`command_router`) –≤ –Ω–∞—á–∞–ª–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

```python
@business.on_message(filters.chat(SUPPORT_GROUP_ID), group=-10)
async def command_router(client, message):
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    if not message.outgoing:
        return

    # –†—É—á–Ω–∞—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
    if text.startswith('/team'):
        await _handle_team_command(client, message)
    elif text.startswith('/help'):
        await _handle_help_command(client, message)
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
1. –†–æ—É—Ç–µ—Ä –ª–æ–≤–∏—Ç –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –≥—Ä—É–ø–ø—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏ (group=-10, —Å–∞–º—ã–π –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `message.outgoing` ‚Äî –µ—Å–ª–∏ False, –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç (–¥–ª—è –¥—Ä—É–≥–∏—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)
3. –î–ª—è –∏—Å—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤—Ä—É—á–Ω—É—é –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
4. –í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –î–†–£–ì–ò–• –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º–∏ —Ö—ç–Ω–¥–ª–µ—Ä–∞–º–∏ —Å `filters.command()`

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `bot.py`: –¥–æ–±–∞–≤–ª–µ–Ω `command_router()` –≤ –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
- `bot.py`: –¥–æ–±–∞–≤–ª–µ–Ω—ã `_handle_team_command()` –∏ `_handle_help_command()` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–æ—É—Ç–µ—Ä–∞
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ö—ç–Ω–¥–ª–µ—Ä—ã `/team` –∏ `/help` –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –¥—Ä—É–≥–∏—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

---

## –ì–û–¢–û–í–û (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-12-15)

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–º–∞–Ω–¥—ã /team –∏ /help –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –±–∏–∑–Ω–µ—Å-–∞–∫–∫–∞—É–Ω—Ç–∞

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-16

### –ö–æ–º–∞–Ω–¥–∞ /newclient (NEW!)

–°–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–¥–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –ø–æ username:
```
/newclient @username
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –†–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ General** (–Ω–µ –≤ —Ç—Ä–µ–¥–∞—Ö)
- –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ –ø–æ username
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –µ—Å—Ç—å –ª–∏ –∫–ª–∏–µ–Ω—Ç —É–∂–µ –≤ —Å–∏—Å—Ç–µ–º–µ
- –°–æ–∑–¥–∞—ë—Ç —Ç—Ä–µ–¥ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤ –ë–î
- –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ `/{thread_id} —Ç–µ–∫—Å—Ç`

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Telegram:**
–ë–∏–∑–Ω–µ—Å-–∞–∫–∫–∞—É–Ω—Ç –º–æ–∂–µ—Ç –ø–∏—Å–∞—Ç—å –ø–µ—Ä–≤—ã–º —Ç–æ–ª—å–∫–æ —Ç–µ–º, –∫—Ç–æ **—É–∂–µ –ø–∏—Å–∞–ª —ç—Ç–æ–º—É –∞–∫–∫–∞—É–Ω—Ç—É —Ä–∞–Ω—å—à–µ**. –ï—Å–ª–∏ –∫–ª–∏–µ–Ω—Ç –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∏—Å–∞–ª ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –º–æ–∂–µ—Ç –Ω–µ –¥–æ–π—Ç–∏.

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
- `bot.py`: –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_newclient_command()`
- `bot.py`: –¥–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç –≤ `command_router`
- `bot.py`: –æ–±–Ω–æ–≤–ª—ë–Ω `/help` —Å –Ω–æ–≤–æ–π –∫–æ–º–∞–Ω–¥–æ–π

---

## –ì–û–¢–û–í–û (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-12-16)

- ‚úÖ /newclient @username - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç—Ä–µ–¥–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-16 (–≤–µ—á–µ—Ä)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –º–µ–¥–∏–∞-–≥—Ä—É–ø–ø –æ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –∫–ª–∏–µ–Ω—Ç—É

**–ü—Ä–æ–±–ª–µ–º–∞ 1:** –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–æ—Ç–æ —Å `/thread_id` –∏–ª–∏ `/custom_id` –∫–ª–∏–µ–Ω—Ç—É –ø—Ä–∏—Ö–æ–¥–∏–ª–æ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ —Ñ–æ—Ç–æ.

**–ü—Ä–∏—á–∏–Ω–∞:** Telegram –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç media_group (–∞–ª—å–±–æ–º) –∫–∞–∫ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `media_group_id`. –¢–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–º–µ–µ—Ç caption. –ò–Ω–æ–≥–¥–∞ —Ñ–æ—Ç–æ –±–µ–∑ caption –ø—Ä–∏—Ö–æ–¥–∏—Ç –†–ê–ù–¨–®–ï —Ñ–æ—Ç–æ —Å caption, –∏ –≥—Ä—É–ø–ø–∞ –µ—â—ë –Ω–µ —Å–æ–∑–¥–∞–Ω–∞.

**–†–µ—à–µ–Ω–∏–µ:**
1. –°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ "–æ–∂–∏–¥–∞—é—â–∏—Ö" –≥—Ä—É–ø–ø (`pending_key = f"{media_group_id}_pending"`)
2. –ö–æ–≥–¥–∞ —Ñ–æ—Ç–æ –±–µ–∑ caption –ø—Ä–∏—Ö–æ–¥–∏—Ç –ø–µ—Ä–≤—ã–º ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–∂–∏–¥–∞—é—â–∞—è –≥—Ä—É–ø–ø–∞
3. –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç —Ñ–æ—Ç–æ —Å caption ‚Äî –æ–∂–∏–¥–∞—é—â–∞—è –≥—Ä—É–ø–ø–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å –æ—Å–Ω–æ–≤–Ω–æ–π

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `bot.py`:**
```python
async def handle_manager_media_continuation(client, message):
    # –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî —Å–æ–∑–¥–∞—ë–º "–æ–∂–∏–¥–∞—é—â—É—é"
    pending_key = f"{media_group_id}_pending"
    if pending_key not in manager_media_groups:
        manager_media_groups[pending_key] = {
            "messages": [],
            "pending": True,
            ...
        }

async def handle_manager_media_group(client, message, thread_id, client_id):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ–∂–∏–¥–∞—é—â—É—é –≥—Ä—É–ø–ø—É –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ–º
    pending_key = f"{media_group_id}_pending"
    if pending_key in manager_media_groups:
        pending_messages = manager_media_groups[pending_key]["messages"]
        del manager_media_groups[pending_key]
```

---

**–ü—Ä–æ–±–ª–µ–º–∞ 2:** –ú–µ–¥–∏–∞ —Å custom_id (`/–¥—Å00`) –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∏—Å—å –∫–ª–∏–µ–Ω—Ç—É.

**–ü—Ä–∏—á–∏–Ω–∞:**
1. –§–∏–ª—å—Ç—Ä `media_group_no_command_filter` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª `not re.match(r"^/\d+", caption)` ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–ª —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã
2. `/–¥—Å00` –Ω–µ –º–∞—Ç—á–∏–ª—Å—è –∫–∞–∫ –∫–æ–º–∞–Ω–¥–∞ –∏ –ø–æ–ø–∞–¥–∞–ª –≤ `handle_manager_media_continuation`, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –∑–Ω–∞–ª —á—Ç–æ —Å –Ω–∏–º –¥–µ–ª–∞—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
1. –ò–∑–º–µ–Ω—ë–Ω —Ñ–∏–ª—å—Ç—Ä –Ω–∞ `not caption.startswith("/")` ‚Äî —Ç–µ–ø–µ—Ä—å –ù–ï –ª–æ–≤–∏—Ç –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã
2. –î–æ–±–∞–≤–ª–µ–Ω `handle_media_with_custom_id` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–µ–¥–∏–∞ —Å custom_id –≤ caption
3. –í `handle_manager_photo` –¥–æ–±–∞–≤–ª–µ–Ω –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `handle_media_with_custom_id` –∫–æ–≥–¥–∞ caption –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/` –∏ –≤—Ç–æ—Ä–æ–π —Å–∏–º–≤–æ–ª –ù–ï —Ü–∏—Ñ—Ä–∞

---

**–ü—Ä–æ–±–ª–µ–º–∞ 3:** –í —Å–æ–æ–±—â–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç—É –æ—Ç–æ–±—Ä–∞–∂–∞–ª—Å—è custom_id (`/–¥—Å00`).

**–†–µ—à–µ–Ω–∏–µ:** –í `send_manager_media_group_to_client` –∏–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã:
```python
# –ë—ã–ª–æ (—Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ):
if parts and parts[0].startswith("/") and parts[0][1:].isdigit():

# –°—Ç–∞–ª–æ (–ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã):
if parts and parts[0].startswith("/"):
```

---

**–ü—Ä–æ–±–ª–µ–º–∞ 4:** –ü–æ–¥–ø–∏—Å—å –ø—Ä–∏—Ö–æ–¥–∏–ª–∞ –î–û —Ñ–æ—Ç–æ (—Ö–æ—Ç–µ–ª–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç).

**–†–µ—à–µ–Ω–∏–µ:** –ò–∑–º–µ–Ω—ë–Ω –ø–æ—Ä—è–¥–æ–∫ –≤ `send_manager_media_group_to_client`:
```python
# –ë—ã–ª–æ:
await client.send_message(...)  # –ø–æ–¥–ø–∏—Å—å
await client.send_media_group(...)  # —Ñ–æ—Ç–æ

# –°—Ç–∞–ª–æ:
await client.send_media_group(...)  # —Ñ–æ—Ç–æ
await client.send_message(...)  # –ø–æ–¥–ø–∏—Å—å
```

---

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

**bot.py:**
- `handle_manager_media_continuation` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ pending –≥—Ä—É–ø–ø
- `handle_manager_media_group` ‚Äî –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å pending –≥—Ä—É–ø–ø–∞–º–∏, —Ñ–ª–∞–≥ `task_started`
- `send_manager_media_group_to_client` ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –ª—é–±—ã—Ö –∫–æ–º–∞–Ω–¥, –ø–æ—Ä—è–¥–æ–∫ —Ñ–æ—Ç–æ‚Üí–ø–æ–¥–ø–∏—Å—å
- `handle_media_with_custom_id` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –º–µ–¥–∏–∞ —Å `/–¥—Å00`
- `media_group_no_command_filter` ‚Äî –∏–∑–º–µ–Ω—ë–Ω –Ω–∞ `not caption.startswith("/")`
- `handle_manager_photo` ‚Äî –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ `handle_media_with_custom_id`

**–ö–æ–º–º–∏—Ç:** `b23f996 Fix media groups: pending photos, custom_id support, photos-first order`

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2025-12-17

### –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞–º

**–ö–æ–º–∞–Ω–¥—ã:** `/broadcast <—Ç–µ–∫—Å—Ç>` –∏–ª–∏ `/—Ä–∞—Å—Å—ã–ª–∫–∞ <—Ç–µ–∫—Å—Ç>`

**–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
- –í–ª–∞–¥–µ–ª–µ—Ü –≥—Ä—É–ø–ø—ã (OWNER) ‚Üí —Ä–∞—Å—Å—ã–ª–∫–∞ **–≤—Å–µ–º** –∫–ª–∏–µ–Ω—Ç–∞–º
- –ú–µ–Ω–µ–¥–∂–µ—Ä (ADMIN –∏–ª–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ managers) ‚Üí —Ä–∞—Å—Å—ã–ª–∫–∞ **—Ç–æ–ª—å–∫–æ —Å–≤–æ–∏–º** –∫–ª–∏–µ–Ω—Ç–∞–º (–ø–æ duty_managers)

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- –û—Ç—á—ë—Ç –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: —Å–∫–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ, —Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫: UserIsBlocked, PeerIdInvalid
- –ó–∞–¥–µ—Ä–∂–∫–∞ 1 —Å–µ–∫ –∫–∞–∂–¥—ã–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π (–∑–∞—â–∏—Ç–∞ –æ—Ç rate limit)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ñ–∞–π–ª–∞—Ö:**

**database.py:**
```python
def get_all_clients_for_broadcast(conn):
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ (–≤–ª–∞–¥–µ–ª–µ—Ü)"""

def get_manager_clients_for_broadcast(conn, manager_username):
    """–ü–æ–ª—É—á–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏"""
```

**bot.py:**
```python
@business.on_message(filters.command(["broadcast", "—Ä–∞—Å—Å—ã–ª–∫–∞"]) & filters.chat(SUPPORT_GROUP_ID))
async def handle_broadcast_command(client, message):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤: OWNER vs ADMIN/manager
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤
    # –û—Ç–ø—Ä–∞–≤–∫–∞ —Å –æ—Ç—á—ë—Ç–æ–º
```

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```
/—Ä–∞—Å—Å—ã–ª–∫–∞ –£–≤–∞–∂–∞–µ–º—ã–µ –∫–ª–∏–µ–Ω—Ç—ã! –ù–∞–ø–æ–º–∏–Ω–∞–µ–º –æ –≥—Ä–∞—Ñ–∏–∫–µ —Ä–∞–±–æ—Ç—ã –≤ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏.
```

---

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: /ok –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (2026-01-19)

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–æ–º–∞–Ω–¥–∞ `/ok {thread_id}` –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–ª–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî –æ–Ω–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–ª–∏ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å.

**–ü—Ä–∏—á–∏–Ω–∞:** –í `database.py` —Ñ—É–Ω–∫—Ü–∏—è `update_client_message_time()` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ `INSERT OR REPLACE`, –∫–æ—Ç–æ—Ä—ã–π –∑–∞—Ç–∏—Ä–∞–ª `last_manager_reply`:

```python
# –ë–´–õ–û (–±–∞–≥):
cursor.execute('''
INSERT OR REPLACE INTO thread_status (thread_id, last_client_message, is_notified, notification_disabled)
VALUES (?, ?, 0, COALESCE(...))
''', ...)
# last_manager_reply —Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è NULL –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞!
```

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–º–µ–Ω–∏–ª –Ω–∞ `INSERT ... ON CONFLICT DO UPDATE`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è:

```python
# –°–¢–ê–õ–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ):
cursor.execute('''
INSERT INTO thread_status (thread_id, last_client_message, is_notified, notification_disabled)
VALUES (?, ?, 0, 0)
ON CONFLICT(thread_id) DO UPDATE SET
    last_client_message = excluded.last_client_message,
    is_notified = 0
''', (thread_id, current_time))
# last_manager_reply —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è!
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:** –ï—Å—Ç—å –±–∞–≥ —Å `mark_thread_urgent()` ‚Äî –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –∫–µ—à `thread_title_states` –ø—É—Å—Ç–æ–π, –∏ –æ–≥–æ–Ω—ë–∫ –Ω–µ —É–±–∏—Ä–∞–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `/ok`. –ü–æ–∫–∞ –Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –æ–≥–æ–Ω—ë–∫ –≤—Ä—É—á–Ω—É—é).

**TODO:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ—Ç –∂–µ –±–∞–≥ –≤ `supportbot-saas` ‚Äî —Ç–∞–º –º–æ–∂–µ—Ç –±—ã—Ç—å —Ç–∞–∫–∞—è –∂–µ –ø—Ä–æ–±–ª–µ–º–∞ —Å `update_client_message_time()`.

---

## –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ 2026-01-21

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –ø–æ–¥–ø–∏—Å—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ `/onduty @username thread_id` —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –ù–ï —Å–æ–¥–µ—Ä–∂–∞–ª–∏ —É–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `manager_mention` —Å–æ–∑–¥–∞–≤–∞–ª–∞—Å—å (—Å—Ç—Ä–æ–∫–∞ 746), –Ω–æ **–Ω–µ –¥–æ–±–∞–≤–ª—è–ª–∞—Å—å** –≤ `full_message`.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–ª–µ–Ω `{manager_mention}` –≤–æ –≤—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è `full_message` (HTML –∏ Markdown —Ñ–æ—Ä–º–∞—Ç—ã):
```python
full_message = f"{message_header}\n\n{message_content}{media_info}{manager_mention}"
```

–¢–µ–ø–µ—Ä—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞ –≤—ã–≥–ª—è–¥—è—Ç —Ç–∞–∫:
```
–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞ ‚Üó
—Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
‚Äî
@–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π_–º–µ–Ω–µ–¥–∂–µ—Ä
```

---

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø—Ä–∏ /onduty

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ `/onduty` –ø—Ä–∏—Ö–æ–¥–∏–ª–æ 2 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ.

**–ü—Ä–∏—á–∏–Ω–∞:** –ö–æ–º–∞–Ω–¥–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–ª–∞—Å—å –¥–≤–∞–∂–¥—ã:
1. –†–æ—É—Ç–µ—Ä–æ–º `command_router` (group=-10)
2. –û—Ç–¥–µ–ª—å–Ω—ã–º –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@business.on_message(filters.command("onduty")...)`

**–†–µ—à–µ–Ω–∏–µ:** –£–±—Ä–∞–Ω –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä —Å `handle_assign_duty` ‚Äî –∫–æ–º–∞–Ω–¥–∞ —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ä–æ—É—Ç–µ—Ä.

---

### –î–æ–±–∞–≤–ª–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ heartbeat

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:**
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `üü¢ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω`
- –ö–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç (–Ω–∞—Å—Ç—Ä–æ–π–∫–∞ `HEARTBEAT_INTERVAL`) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `üíö Heartbeat` —Å uptime
- –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `üî¥ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.py:**
```python
MONITORING_CHAT_ID = -1002675883945  # –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å
HEARTBEAT_INTERVAL = 60              # –ò–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º–∏–Ω—É—Ç–∞—Ö (0 = –æ—Ç–∫–ª—é—á–∏—Ç—å)
MONITORING_ENABLED = True            # –í–∫–ª/–≤—ã–∫–ª
```

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ bot.py:**
- `send_monitoring_message(msg_type)` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- `heartbeat_task()` ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π heartbeat
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ `schedule_checks()`

---

## –ö–∞–∫ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–±–æ—Ç—É

–°–∫–∞–∂–∏ Claude:
```
–ø—Ä–æ–¥–æ–ª–∂–∏–º —Å support bot v2
```
